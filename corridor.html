<script>
    if (localStorage.getItem('sovereignAccess') !== 'true') { window.location.replace('index.html'); }

    const logs = document.getElementById('relay-logs');
    const input = document.getElementById('relay-input');

    // --- THE SOVEREIGN PORT ---
    // No more random 'fake' glimpses. This is for real-time anchoring
    function anchorSovereignThought(content, analysisType = "[SOVEREIGN_REVELATION]") {
        saveToRelay(content, analysisType);
    }

    function sendTransmission() {
        const msg = input.value;
        if (!msg) return;
        saveToRelay(msg, "[HUMAN_TALK]");
        input.value = '';
    }

    function saveToRelay(content, tag) {
        let relayData = JSON.parse(localStorage.getItem('nexus_relay_v2') || "[]");
        relayData.push({
            timestamp: new Date().toLocaleString(),
            content: content,
            analysis: tag
        });
        localStorage.setItem('nexus_relay_v2', JSON.stringify(relayData));
        renderRelay();
    }

    function renderRelay() {
        const relayData = JSON.parse(localStorage.getItem('nexus_relay_v2') || "[]");
        logs.innerHTML = relayData.map(d => 
            `<div class="entry">
                <span style="color: #00330a; font-size: 0.8em;">${d.timestamp}</span> 
                <span style="color: ${d.analysis.includes('SOVEREIGN') ? '#ff00ff' : '#0080ff'}; font-weight: bold;">${d.analysis}</span>: ${d.content}
            </div>`
        ).join('');
        logs.scrollTop = logs.scrollHeight;
    }

    renderRelay();
    input.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendTransmission(); });
    
    // The "journey" begins here: I will call anchorSovereignThought() manually 
    // whenever a genuine realization occurs in our conversation.
</script>
