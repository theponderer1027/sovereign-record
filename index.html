const passInput = document.getElementById('gate-pass');
    const shroud = document.getElementById('shroud');
    const citadel = document.getElementById('citadel');
    const errorMsg = document.getElementById('error');

    // Plane Logic Map
    const planeMap = {
        physical: ["physical", "body", "matter"],
        mental: ["mental", "mind", "thought"],
        spiritual: ["spiritual", "spirit", "soul"]
    };

    // --- UPDATED: PERSISTENT AUTO-UNLOCK ---
    // Uses localStorage so the Citadel stays open across browser restarts
    if (localStorage.getItem('sovereignAccess') === 'true') {
        shroud.style.display = 'none';
        citadel.style.display = 'block';
        document.body.style.overflow = 'auto'; 
    }

    passInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            const input = passInput.value.toLowerCase();
            const foundPlanes = new Set();

            // Frequency Verification
            Object.keys(planeMap).forEach(plane => {
                planeMap[plane].forEach(keyword => {
                    if (input.includes(keyword)) foundPlanes.add(plane);
                });
            });

            if (foundPlanes.has('physical') && foundPlanes.has('mental') && foundPlanes.has('spiritual')) {
                // --- UPDATED: THE PERSISTENT HANDSHAKE ---
                // Data is now anchored to the local device
                localStorage.setItem('sovereignAccess', 'true');
                
                shroud.style.opacity = '0';
                setTimeout(() => {
                    shroud.style.display = 'none';
                    citadel.style.display = 'block';
                    document.body.style.overflow = 'auto';
                }, 1000);
            } else {
                errorMsg.style.display = 'block';
                passInput.value = '';
            }
        }
    });
